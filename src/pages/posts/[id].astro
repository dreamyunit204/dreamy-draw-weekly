---
import { getCollection, render } from 'astro:content';
import Base from '../../layouts/Base.astro';

export async function getStaticPaths() {
  const posts = await getCollection('posts');
  return posts.map((post) => ({
    params: { id: post.id },
    props: { post },
  }));
}

const { post } = Astro.props;
const { Content } = await render(post);
const base = import.meta.env.BASE_URL;
---

<Base title={post.data.title} description={post.data.description}>
  <a href={base} class="back-link">← All Issues</a>

  <article>
    <header class="post-header">
      <div class="post-meta">
        {post.data.date}
        {post.data.issue && <span> · Issue #{post.data.issue}</span>}
      </div>
      <h1>{post.data.title}</h1>
      {post.data.tags?.length > 0 && (
        <div style="margin-top:0.75rem;display:flex;gap:0.35rem;flex-wrap:wrap;">
          {post.data.tags.map((tag: string) => <span class="tag">{tag}</span>)}
        </div>
      )}
    </header>

    <div class="post-content">
      <Content />
    </div>
  </article>
</Base>
